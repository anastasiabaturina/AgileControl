@page "/start"
@inject NavigationManager NavigationManager
@inject AuthenticationStateProvider AuthStateProvider
@inherits LayoutComponentBase
@using MudBlazor
@using System.Security.Claims

<style>
    .welcome-container {
        font-family: 'Inter', sans-serif;
        line-height: 1.6;
    }

    .title-font {
        font-family: 'Montserrat', sans-serif;
        letter-spacing: -0.5px;
    }

    .feature-item {
        padding-left: 2rem;
        position: relative;
        margin-bottom: 1rem;
    }

    .feature-icon {
        position: absolute;
        left: 0;
        top: 0.2em;
    }

    .quote-card {
        border-left: 4px solid var(--mud-palette-primary);
        background-color: rgba(var(--mud-palette-primary-rgb), 0.05);
    }
</style>

<MudContainer Class="welcome-container my-16" MaxWidth="MaxWidth.Large">
    <MudPaper Class="pa-8" Elevation="5" Style="border-radius: 12px;">
        <MudGrid Spacing="4">
            <MudItem xs="12" Class="text-center mb-6">
                <MudText Typo="Typo.h3" Color="Color.Primary" Class="mb-4 title-font" Style="font-weight: 900;">
                    Добро пожаловать в <MudText Typo="Typo.h3" Color="Color.Secondary" Inline="true" Class="title-font" Style="font-weight: 900;">Agile Control</MudText>
                </MudText>
                <MudText Typo="Typo.subtitle1" Class="mb-4" Style="font-weight: 400;">
                    Ваше универсальное решение для управления проектами и командной работы
                </MudText>
            </MudItem>

            <MudItem xs="12" Class="text-center mb-8">
                <MudIcon Class="mx-4" Icon="@Icons.Material.Filled.RocketLaunch" Color="Color.Primary" Size="Size.Large" Style="opacity: 0.9;" />
                <MudIcon Class="mx-4" Icon="@Icons.Material.Filled.Group" Color="Color.Primary" Size="Size.Large" Style="opacity: 0.9;" />
                <MudIcon Class="mx-4" Icon="@Icons.Material.Filled.AssignmentTurnedIn" Color="Color.Primary" Size="Size.Large" Style="opacity: 0.9;" />
                <MudIcon Class="mx-4" Icon="@Icons.Material.Filled.TrendingUp" Color="Color.Primary" Size="Size.Large" Style="opacity: 0.9;" />
            </MudItem>

            <MudItem xs="12" Class="mb-6">
                <div class="feature-item">
                    <MudIcon Icon="@Icons.Material.Filled.CheckCircle" Color="Color.Success" Size="Size.Small" Class="feature-icon" />
                    <MudText Typo="Typo.body1" Style="font-weight: 500;">
                        Создавайте проекты за считанные секунды
                    </MudText>
                </div>

                <div class="feature-item">
                    <MudIcon Icon="@Icons.Material.Filled.CheckCircle" Color="Color.Success" Size="Size.Small" Class="feature-icon" />
                    <MudText Typo="Typo.body1" Style="font-weight: 500;">
                        Приглашайте коллег и распределяйте задачи
                    </MudText>
                </div>

                <div class="feature-item">
                    <MudIcon Icon="@Icons.Material.Filled.CheckCircle" Color="Color.Success" Size="Size.Small" Class="feature-icon" />
                    <MudText Typo="Typo.body1" Style="font-weight: 500;">
                        Отслеживайте прогресс с учётом современных agile-практик
                    </MudText>
                </div>
            </MudItem>

            <MudItem xs="12" Class="mb-8">
                <MudCard Elevation="0" Class="pa-4 quote-card" Style="border-radius: 8px;">
                    <MudText Typo="Typo.body1" Style="font-weight: 400;">
                        "Интуитивно понятный интерфейс и мощные инструменты позволят вам легко организовать рабочий процесс, повысить продуктивность команды и добиться результатов быстрее."
                    </MudText>
                </MudCard>
            </MudItem>

            @if (_isAuthenticated)
            {
                <MudItem xs="12" Class="text-center">
                    <MudButtonGroup Variant="Variant.Filled" Color="Color.Primary" Class="justify-center" Style="gap: 12px;">
                        <MudButton Variant="Variant.Filled"
                                   EndIcon="@Icons.Material.Filled.Login"
                                   OnClick="NavigateToMain"
                                   Style="font-weight: 500; letter-spacing: 0.5px; text-transform: none; padding: 8px 20px;">
                            Перейти на главную страницу
                        </MudButton>
                    </MudButtonGroup>
                </MudItem>
            }
            else
            {
                <MudItem xs="12" Class="text-center">
                    <MudText Typo="Typo.body1" Class="mb-4" Style="font-weight: 500;">
                        🔒 Чтобы начать — просто войдите в Agile Control
                    </MudText>
                    <MudText Typo="Typo.body1" Class="mb-6" Style="font-weight: 500;">
                        🆕 Ещё нет аккаунта? Зарегистрируйтесь — это быстро и бесплатно!
                    </MudText>

                    <MudButtonGroup Variant="Variant.Filled" Color="Color.Primary" Class="justify-center" Style="gap: 12px;">
                        <MudButton Variant="Variant.Filled"
                                   EndIcon="@Icons.Material.Filled.Login"
                                   OnClick="NavigateToAuth"
                                   Style="font-weight: 500; letter-spacing: 0.5px; text-transform: none; padding: 8px 20px;">
                            Войти
                        </MudButton>
                        <MudButton Variant="Variant.Outlined"
                                   EndIcon="@Icons.Material.Filled.PersonAdd"
                                   OnClick="NavigateToRegister"
                                   Style="font-weight: 500; letter-spacing: 0.5px; text-transform: none; padding: 8px 20px;">
                            Регистрация
                        </MudButton>
                    </MudButtonGroup>
                </MudItem>
            }         
        </MudGrid>
    </MudPaper>
</MudContainer>

@code {
    private bool _isAuthenticated = false;
    private ClaimsPrincipal _user = new();

    protected override async Task OnInitializedAsync()
    {
        var authState = await AuthStateProvider.GetAuthenticationStateAsync();
        _user = authState.User;
        _isAuthenticated = _user.Identity?.IsAuthenticated ?? false;
    }

    private void NavigateToMain()
    {
        NavigationManager.NavigateTo("/home");
    }

    private void NavigateToRegister()
    {
        NavigationManager.NavigateTo("/register");
    }

    private void NavigateToAuth()
    {
        NavigationManager.NavigateTo("/login");
    }
}